---
- name: Setup everything
  hosts: all
  become: true
  vars:
    # System
    woomy_domain: woomy.be
    colle_domain: colle.dev
    woomy_user: woomy
    system_users:
      - woomy
      - polyrhachis

    docker_user: docker
    services_dirname: services

    # Joplin
    joplin_proto: https
    joplin_main_domain: joplin.{{ woomy_domain }}
    joplin_all_domains: www.{{ joplin_main_domain }} joplin.{{ colle_domain }}
    joplin_mailer_noreply: joplin@{{ woomy_domain }}

    # NextCloud
    nextcloud_domain: nextcloud.{{ woomy_domain }}
    nextcloud_trusted_domains: www.{{ nextcloud_domain }} nextcloud.{{ colle_domain }}
    nextcloud_mail_from: nextcloud

    # Vaultwarden
    vaultwarden_proto: https
    vaultwarden_main_domain: bitwarden.{{ woomy_domain }}
    vaultwarden_all_domains: www.bitwarden.{{ woomy_domain }}
    vaultwarden_smtp_from: vaultwarden@{{ woomy_domain }}
  roles:
    - role: timezone
      tags: sysconfig
    - role: hostname
      tags: sysconfig
    - role: dnf
      tags:
        - sysconfig
        - packages
    - role: users
      tags:
        - sysconfig
        - users
        - static
    - role: journal
      tags: sysconfig
    - role: firewall
      tags: sysconfig
    - role: fail2ban
      tags: sysconfig
    - role: sshd_config
      tags: sysconfig
    - role: caddy
      tags: web
    - role: docker
      tags:
        - docker
        - vaultwarden
        - joplin
        - nextcloud
        - fiibot_id
        - fiibot_interservers
        - fiibot_logger
        - fiibot_moderation
        - monitoring
    - role: vaultwarden
      tags: vaultwarden
    - role: joplin
      tags: joplin
    - role: static
      tags: static
    - role: nextcloud
      tags: nextcloud
    - role: fiibot_id
      tags: fiibot_id
    - role: fiibot_interservers
      tags: fiibot_interservers
    - role: fiibot_logger
      tags: fiibot_logger
    - role: fiibot_moderation
      tags: fiibot_moderation
    - role: borg
      tags: borg
    - role: prometheus
      tags: monitoring